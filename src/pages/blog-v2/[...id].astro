---
// Blog Post Page
// ------------
// Description: The blog post page is a page that displays a single blog post.

// Components
// - Layout
import Layout from '../../layouts/BlogLayout.astro'

// Data
import { getCollection, render } from 'astro:content'

export async function getStaticPaths() {
	// Helper function to get locale from entry ID
	function getLocaleFromId(id: string): string {
		if (id.startsWith('fr/')) return 'fr'
		if (id.startsWith('en/')) return 'en'
		return 'en' // default to English
	}

	// Helper function to get base ID without locale prefix
	function getBaseId(id: string): string {
		if (id.startsWith('fr/')) return id.replace('fr/', '')
		if (id.startsWith('en/')) return id.replace('en/', '')
		return id
	}

	const blogPosts = await getCollection('blog')
	// Filter to only English entries (en/ prefix or no prefix)
	const englishPosts = blogPosts.filter((entry) => {
		const locale = getLocaleFromId(entry.id)
		return locale === 'en'
	})
	
	return englishPosts.map((entry) => {
		const baseId = getBaseId(entry.id)
		return {
			params: { id: baseId },
			props: { entry }
		}
	})
}
const { entry } = Astro.props
const { Content } = await render(entry)
---

<Layout frontmatter={entry.data}>
	<Content />
</Layout>

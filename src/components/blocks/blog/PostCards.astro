---
// Post Cards
// ------------
// Description: A layout for blog posts with a grid of cards and pagination
// Properties:
// - data: The data of the blog posts
// - pagination: The pagination of the blog posts

// Components
// - Layout
import Section from '../../ui/Section.astro'
import Row from '../../ui/Row.astro'
import Col from '../../ui/Col.astro'
// - UI
import Card from '../../ui/cards/Card.astro'
// - Blocks
import TitleSection from '../basic/TitleSection.astro'
// - Scripts
import { postSubtitle } from '../../scripts/postScripts.ts'

// - Collection
import { getCollection } from 'astro:content'

// Helper function to get locale from entry ID
function getLocaleFromId(id: string): string {
	if (id.startsWith('fr/')) return 'fr'
	if (id.startsWith('en/')) return 'en'
	return 'en' // default to English
}

// Helper function to get base ID without locale prefix
function getBaseId(id: string): string {
	if (id.startsWith('fr/')) return id.replace('fr/', '')
	if (id.startsWith('en/')) return id.replace('en/', '')
	return id
}

// Get current locale
const currentLocale = Astro.currentLocale || 'en'
const localePrefix = currentLocale === 'fr' ? '/fr' : ''

const allWorkProjects = await getCollection('blog')
// Filter by current locale
const localeBlogPosts = allWorkProjects.filter((entry) => {
	const locale = getLocaleFromId(entry.id)
	return locale === currentLocale
})
// Function to sort case studies by date
const sortedBlogPosts = localeBlogPosts.sort((a: any, b: any) => {
	return new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
})
---

<TitleSection
	title={currentLocale === 'fr'
		? 'Cosas que pensamos, y a veces lamentamos.'
		: 'Stuff we think, and some times regret.'}
	text={currentLocale === 'fr'
		? 'Consejos, desahogos e historias del lado del diseÃ±o de internet. Reflexiones inteligentes sobre branding, digital y trabajo creativo.'
		: 'Tips, rants, and stories from the design side of the internet. Smart takes on branding, digital, and creative work.'}
	link={`${localePrefix}/blog-v2`}
	classes="lg:pb-15!"
/>
<Section classes="pt-0!">
	<Row>
		{
			// Render the first 3 blog posts in a custom layout
			sortedBlogPosts.slice(0, 3).map((post: any, index: number) => {
				// First post: large featured card spanning 8 columns
				if (index === 0) {
					return (
						<Col span="8">
							<Card
								title={post.data.title}
								subtitle={post.data.subtitle}
								link={`${localePrefix}/blog/${getBaseId(post.id)}`}
								image={post.data.image}
								video={post.data.video}
								classes="h-full"
								cardMediaClasses="order-2 max-h-[380px] w-full object-cover"
								cardHeaderClasses="lg:p-12! lg:pb-7.5! pb-6! [&_span]:lg:text-[21px]! [&_span]:lg:leading-9! [&_span]:max-w-[600px] [&_span]:inline-block!"
								cardBodyClasses="order-3 lg:p-12! lg:pt-7.5! pt-6!"
							>
								<p class="columns-none line-clamp-8 gap-6 lg:columns-2">{post.data.description}</p>
							</Card>
						</Col>
					)
				}

				// Second & third posts: stacked vertically in one Col (span 4)
				if (index === 1) {
					return (
						<Col span="4" classes="flex flex-col gap-6">
							{[1, 2].map((i) => {
								const p = sortedBlogPosts[i]
								return (
									<Card
										title={p.data.title}
										subtitle={postSubtitle(p.data.author, p.data.pubDate, currentLocale)}
										titleLink={`${localePrefix}/blog/${getBaseId(p.id)}`}
										classes="h-full"
									>
										<p class="line-clamp-5"> {p.data.description}</p>
									</Card>
								)
							})}
						</Col>
					)
				}
			})
		}
	</Row>
</Section>
